<%- include('../partials/adminHeader')%>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>

<!-- <script
  src="http://code.jquery.com/jquery-2.0.3.min.js"
  data-semver="2.0.3"
  data-require="jquery"
></script> -->
<link
  href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables_themeroller.css"
  rel="stylesheet"
  data-semver="1.9.4"
  data-require="datatables@*"
/>
<link
  href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables.css"
  rel="stylesheet"
  data-semver="1.9.4"
  data-require="datatables@*"
/>
<link
  href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_table_jui.css"
  rel="stylesheet"
  data-semver="1.9.4"
  data-require="datatables@*"
/>
<link
  href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_table.css"
  rel="stylesheet"
  data-semver="1.9.4"
  data-require="datatables@*"
/>
<link
  href="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/demo_page.css"
  rel="stylesheet"
  data-semver="1.9.4"
  data-require="datatables@*"
/>
<link
  data-require="jqueryui@*"
  data-semver="1.10.0"
  rel="stylesheet"
  href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.0/css/smoothness/jquery-ui-1.10.0.custom.min.css"
/>
<script
  data-require="jqueryui@*"
  data-semver="1.10.0"
  src="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.0/jquery-ui.js"
></script>
<script
  src="//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/jquery.dataTables.js"
  data-semver="1.9.4"
  data-require="datatables@*"
></script>
<!--start page wrapper xzxz -->
<div class="page-wrapper">
  <div class="page-content">
    <!--breadcrumb-->
    <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
      <div class="breadcrumb-title pe-3">Tables</div>
      <div class="ps-3">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb mb-0 p-0">
            <li class="breadcrumb-item">
              <a href="javascript:;"><i class="bx bx-home-alt"></i></a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
              Data Table
            </li>
          </ol>
        </nav>
      </div>
      <div class="ms-auto">
        <div class="btn-group">
          <button type="button" class="btn btn-primary">Settings</button>
          <button
            type="button"
            class="btn btn-primary split-bg-primary dropdown-toggle dropdown-toggle-split"
            data-bs-toggle="dropdown"
          >
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg-end">
            <a class="dropdown-item" href="javascript:;">Action</a>
            <a class="dropdown-item" href="javascript:;">Another action</a>
            <a class="dropdown-item" href="javascript:;">Something else here</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="javascript:;">Separated link</a>
          </div>
        </div>
      </div>
    </div>
    <!--end breadcrumb-->

    <h6 class="mb-0 text-uppercase">DataTable Import</h6>
    <hr />
    <div class="row" style=" margin: 20px;">
      <div class="col-md-3">
          <h4>Date from</h4>
          <input type="date"  class="form-control" id="datefilterfrom" data-date-split-input="true">
      </div>
      <div class="col-md-3">
          <h4>Date to</h4>
        <input type="date" class="form-control" id="datefilterto" data-date-split-input="true">
      </div>
      <div class="toolbar hidden-print">
        <div class="text-end">
          <button id="button1" type="button" class="btn btn-dark"><i class="fa fa-print"></i> Print</button>
          <!-- <button type="button" class="btn btn-danger"><i class="fa fa-file-pdf-o"></i> Export as PDF</button> -->
        </div>
        <hr/>
      </div>
      </div>
  <!-- <div>
      <div id="filter-box" style="display: none;">
          <label style="margin-left: 1%;">From:</label>
          <input id="startDate" type="date">
          <label>To:</label>
          <input id="endDate" type="date">
      </div>
  </div> -->
      <!-- <a id="button1" class="btn fas fa-filter" style="color: #8B2F49;" ></a> -->
  <div class="card">
      <div class="card-body">
          <div class="table-responsive">
            
            <table id="datatable" class="table table-striped table-bordered">
              <thead>
                  <tr>
                      <th>Order ID</th>
                      <th>userName</th>
                      <th>phoneNumber</th>
                      <th>location</th>
                      <th>Order Date</th>
                      <th>Detail productId </th>
                      <th>Detail quantity </th>
                      <th>Order totalPrice</th>
                      <th>Order status</th>
                      <th>Action</th>
                      <th>Invoice</th>

                  </tr>
              </thead>
              <tbody>


                  <% viewAllOrders.forEach((e)=>{%>
                      <tr>
                          <td>
                              <%= e.order.id%>
                          </td>
                          <td>
                              <!-- <%=//e.order.register.userName %> -->
                              <%if(e.order.register){%>
                                <%=e.order.register.userName %>
                                <%}else {%>
                                  <a >User Deleted</a>
                                <%}%>
                          </td>
                          <td>
                            <%if(e.order.register){%>
                              <%= e.order.register.phoneNumber%>
                              <%}else {%>
                                <a >User Deleted</a>
                              <%}%>

                              
                          </td>
                        
                          <td>

                            <%if(e.order.register){%>
                              <%= e.order.register.location%>
                              <%}else {%>
                                <a >User Deleted</a>
                              <%}%>
                            
                          </td>
                          <td>
                            <%if(e.order.register){%>
                              <%= e.order.date.toISOString().split('T')[0]%>
                              <%}else {%>
                                <a >User Deleted</a>
                              <%}%>
                              
                          </td>
                          <td>
                              <%= e.product.name%>
                          </td>
                          <td>
                              <%= e.quantity%>
                          </td>
                          <td>
                              <%= e.order.totalPrice%>
                          </td>
                          <td>
                              <%if(e.order.status == null ||e.order.status == 'Active' ){%>
                                  <a class="btn btn-warning">Active</a>
                                  <%}else if (e.order.status == 'Completed'){%>
                                      <a class="btn btn-success">Completed</a>
                                      <%} else if (e.order.status == 'Cancel'){%>
                                          <a class="btn btn-danger">Cancel</a>
                                          <%}%>

                          </td>






                          <!-- <td><a href="">Delete</a></td> -->
                          <td>

                              <select onchange="update(`<%=e.order.id%>`)" id="<%=e.order.id%>">
                                  
                                  
                             
                              <option value="Active"><a class="btn btn-warning">Active</a></option>
                              <option value="Completed"><a class="btn btn-primary">Completed</a></option>
                              <option value="Cancel"><a class="btn btn-success">Cancel</a></option>
                          </select>
                          <a class="btn btn-success fas fa-pen" href="/admin/Order-update/<%=e.id%>"></a></td>


                          </td>
                           </td>
                                        <%if(e.order.register){%>
                                            <td> <a class="btn btn-success fas fa-print" href="/admin/single-order/<%=e.order.id%>"></a></td></td>
                                           
                                            <%}else {%>
                                           <td><a>User Deleted</a></td>
                                            <%}%>


                      </tr>

                      <%})%>


              </tbody>
              <tfoot>
                  <tr>
                      <th>userName</th>
                      <th>phoneNumber</th>
                      <th>location</th>
                      <th>Order shipDate</th>
                      <th>Detail productId </th>
                      <th>Detail quantity </th>
                      <th>Order totalPrice</th>
                      <th>Order status</th>
                      <th>Action</th>
                      <th>Invoice</th>
                  </tr>
              </tfoot>
          </table>
          
        </div>
      </div>
  </div>
</div>
<!--end page wrapper -->
<!--start overlay-->
<div class="overlay toggle-icon"></div>
<!--end overlay-->
<!--Start Back To Top Button--><a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
<!--End Back To Top Button-->
<footer class="page-footer">
  <p class="mb-0">Copyright Â© 2021. All right reserved.</p>
</footer>
</div>
<!--end wrapper-->
<!--start switcher-->
<div class="switcher-wrapper">
  <div class="switcher-btn"> <i class='bx bx-cog bx-spin'></i>
  </div>
  <div class="switcher-body">
      <div class="d-flex align-items-center">
          <h5 class="mb-0 text-uppercase">Theme Customizer</h5>
          <button type="button" class="btn-close ms-auto close-switcher" aria-label="Close"></button>
      </div>
      <hr/>
      <h6 class="mb-0">Theme Styles</h6>
      <hr/>
      <div class="d-flex align-items-center justify-content-between">
          <div class="form-check">
              <input class="form-check-input" type="radio" name="flexRadioDefault" id="lightmode" checked>
              <label class="form-check-label" for="lightmode">Light</label>
          </div>
          <div class="form-check">
              <input class="form-check-input" type="radio" name="flexRadioDefault" id="darkmode">
              <label class="form-check-label" for="darkmode">Dark</label>
          </div>
          <div class="form-check">
              <input class="form-check-input" type="radio" name="flexRadioDefault" id="semidark">
              <label class="form-check-label" for="semidark">Semi Dark</label>
          </div>
      </div>
      <hr/>
      <div class="form-check">
          <input class="form-check-input" type="radio" id="minimaltheme" name="flexRadioDefault">
          <label class="form-check-label" for="minimaltheme">Minimal Theme</label>
      </div>
      <hr/>
      <h6 class="mb-0">Header Colors</h6>
      <hr/>
      <div class="header-colors-indigators">
          <div class="row row-cols-auto g-3">
              <div class="col">
                  <div class="indigator headercolor1" id="headercolor1"></div>
              </div>
              <div class="col">
                  <div class="indigator headercolor2" id="headercolor2"></div>
              </div>
              <div class="col">
                  <div class="indigator headercolor3" id="headercolor3"></div>
              </div>
              <div class="col">
                  <div class="indigator headercolor4" id="headercolor4"></div>
              </div>
              <div class="col">
                  <div class="indigator headercolor5" id="headercolor5"></div>
              </div>
              <div class="col">
                  <div class="indigator headercolor6" id="headercolor6"></div>
              </div>
              <div class="col">
                  <div class="indigator headercolor7" id="headercolor7"></div>
              </div>
              <div class="col">
                  <div class="indigator headercolor8" id="headercolor8"></div>
              </div>
          </div>
      </div>
      <hr/>
      <h6 class="mb-0">Sidebar Colors</h6>
      <hr/>
      <div class="header-colors-indigators">
          <div class="row row-cols-auto g-3">
              <div class="col">
                  <div class="indigator sidebarcolor1" id="sidebarcolor1"></div>
              </div>
              <div class="col">
                  <div class="indigator sidebarcolor2" id="sidebarcolor2"></div>
              </div>
              <div class="col">
                  <div class="indigator sidebarcolor3" id="sidebarcolor3"></div>
              </div>
              <div class="col">
                  <div class="indigator sidebarcolor4" id="sidebarcolor4"></div>
              </div>
              <div class="col">
                  <div class="indigator sidebarcolor5" id="sidebarcolor5"></div>
              </div>
              <div class="col">
                  <div class="indigator sidebarcolor6" id="sidebarcolor6"></div>
              </div>
              <div class="col">
                  <div class="indigator sidebarcolor7" id="sidebarcolor7"></div>
              </div>
              <div class="col">
                  <div class="indigator sidebarcolor8" id="sidebarcolor8"></div>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- <script>
//     const box = document.getElementById('filter-box');
//     const btn = document.getElementById('button1');
//     console.log("hehe", box,btn);
//     btn.addEventListener('click', function handleClick() {
//     if (box.style.display === 'none') {
//         box.style.display = 'block';

//         btn.textContent = 'Hide';
//     } else {
//         box.style.display = 'none';

//         btn.textContent = '';
//     }
//     });

//     $(document).ready(function() {
//         $('#example').DataTable();
//     });


//     $(document).ready(function() {
//         var table = $('#example2').DataTable({
//             lengthChange: false,
//             "dom": 'Bfrtip',
//             "buttons": [{
//                     extend: 'copy',
//                     className: 'btn btn-primary rounded-0',
//                     text: '<i class="far fa-file-copy"></i> Copy'
//                 },

//                 {
//                     extend: 'excel',
//                     className: 'btn btn-primary rounded-0',
//                     text: '<i class="far fa-file-excel"></i> Excel'
//                 }, {
//                     extend: 'pdf',
//                     className: 'btn btn-primary rounded-0',
//                     text: '<i class="far fa-file-pdf"></i> Pdf'
//                 }, {
//                     extend: 'csv',
//                     className: 'btn btn-primary rounded-0',
//                     text: '<i class="fas fa-file-csv"></i> CSV'
//                 }, {
//                     extend: 'print',
//                     className: 'btn btn-primary rounded-0',
//                     text: '<i class="fas fa-print"></i> Print'
//                 }
//             ]
//         });

//         table.buttons().container()
//             .appendTo('#example2_wrapper .col-md-6:eq(0)');
//     });
// </script> -->
<!--end switcher-->

<script>
  const update = async(id) => {
      var select = document.getElementById(id);
      console.log(select)
      var option = select.options[select.selectedIndex].value;
      console.log(option)

      var today = new Date();
      var dd = String(today.getDate()).padStart(2, '0');
      var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
      var yyyy = today.getFullYear();

      today = yyyy + '/' + mm + '/' + dd;
      console.log(today);
      
      const data = await fetch(window.location.origin + `/orders/${id}`, {
          method: 'put',
          body: JSON.stringify({

              status: option,
              shipDate: today

          }),
          headers: {
              'Content-Type': 'application/json'

          }
      })
      const rec = await data.text();
      console.log(rec)
      if(rec){
          location.assign('http://localhost:3000/admin/all-Order')
      }

  }

  //fileter laga deta oeeee
  function filterRows() {
var from = $('#datefilterfrom').val();
var to = $('#datefilterto').val();

if (!from && !to) { // no value for from and to
return;
}

from = from || '1970-01-01'; // default from to a old date if it is not set
to = to || '2999-12-31';

var dateFrom = moment(from);
var dateTo = moment(to);

$('#datatable tbody tr').each(function(i,tr) {
var val = $(tr).find("td:nth-child(5)").text();
var dateVal = moment(val, "YYYY/MM/DD");
var visible = (dateVal.isBetween(dateFrom, dateTo, null, [])) ? "" : "none"; // [] for inclusive
$(tr).css('display', visible);
});
}

$('#datefilterfrom').on("change", filterRows);
$('#datefilterto').on("change", filterRows);
</script>

    <script>
      $(function () {
        var oTable = $("#datatable").DataTable({
          paging: false,
          ordering: false,
          info: false,
          oLanguage: {
            sSearch: "Filter Data",
          },
          iDisplayLength: -1,
          sPaginationType: "full_numbers",
           "dom": 'Bfrtip',
                "buttons": [
                    // {
                    //     extend: 'copy',
                    //     className: 'btn btn-primary rounded-0',
                    //     text: '<i class="far fa-file-copy"></i> Copy'
                    // },

                    // {
                    //     extend: 'excel',
                    //     className: 'btn btn-primary rounded-0',
                    //     text: '<i class="far fa-file-excel"></i> Excel'
                    // },
                     {
                        extend: 'pdf',
                        className: 'btn btn-primary rounded-0',
                        text: '<i class="far fa-file-pdf"></i> Pdf'
                    },
                    //  {
                    //     extend: 'csv',
                    //     className: 'btn btn-primary rounded-0',
                    //     text: '<i class="fas fa-file-csv"></i> CSV'
                    // }, 
                    {
                        extend: 'print',
                        className: 'btn btn-primary rounded-0',
                        text: '<i class="fas fa-print"></i> Print'
                    }
                ]
        });
        table.buttons().container()
				.appendTo( '#example2_wrapper .col-md-6:eq(0)' );

        $("#datepicker_from")
          .datepicker({
            showOn: "button",
            buttonImage: "images/calendar.gif",
            buttonImageOnly: false,
            onSelect: function (date) {
              minDateFilter = new Date(date).getTime();
              oTable.fnDraw();
            },
          })
          .keyup(function () {
            minDateFilter = new Date(this.value).getTime();
            oTable.fnDraw();
          });

        $("#datepicker_to")
          .datepicker({
            showOn: "button",
            buttonImage: "images/calendar.gif",
            buttonImageOnly: false,
            onSelect: function (date) {
              maxDateFilter = new Date(date).getTime();
              oTable.fnDraw();
            },
          })
          .keyup(function () {
            maxDateFilter = new Date(this.value).getTime();
            oTable.fnDraw();
          });
      });

      // Date range filter
      minDateFilter = "";
      maxDateFilter = "";

      $.fn.dataTableExt.afnFiltering.push(function (
        oSettings,
        aData,
        iDataIndex
      ) {
        if (typeof aData._date == "undefined") {
          aData._date = new Date(aData[0]).getTime();
        }

        if (minDateFilter && !isNaN(minDateFilter)) {
          if (aData._date < minDateFilter) {
            return false;
          }
        }

        if (maxDateFilter && !isNaN(maxDateFilter)) {
          if (aData._date > maxDateFilter) {
            return false;
          }
        }

        return true;
      });
////////////////////////// for printing data//////////////////
      function printData()
        {
           var divToPrint=document.getElementById("datatable");
           newWin= window.open("");
           newWin.document.write(divToPrint.outerHTML);
           newWin.print();
           newWin.close();
        }
        
        $('#button1').on('click',function(){
        printData();
        })
    </script>

    <%- include('../partials/adminFooter')%>
  </div>
</div>
